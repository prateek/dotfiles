# tmux config (dotfiles)

# Mouse: allow scrolling/click selection in iTerm2.
set -g mouse on

# History
set -g history-limit 200000

# Indexing (1-based is easier to reason about)
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Use vi keys for copy mode + command prompt.
set -g status-keys vi
set -g mode-keys vi

# Copy mode (quick enter without prefix).
bind-key -n C-y copy-mode

# Splits: inherit the parent pane's working directory.
bind-key '"' split-window -v -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"

# New windows (“tabs”): start in $HOME.
bind-key c new-window -c "$HOME"

# Better titles (lets iTerm2 tabs reflect tmux window names).
set -g set-titles on
set -g set-titles-string '#W'

# Better terminal defaults + truecolor.
if-shell 'command -v infocmp >/dev/null 2>&1 && infocmp tmux-256color >/dev/null 2>&1' 'set -g default-terminal "tmux-256color"'
set -as terminal-features ',xterm-256color:RGB'
set -as terminal-features ',tmux-256color:RGB'

# Keep PATH in sync when new clients attach (helps with long-lived tmux servers).
set -ga update-environment " PATH"

# Command palette (fzf) in a tmux popup.
bind-key P display-popup -E -w 80% -h 60% "bash ~/.config/tmux/scripts/command-palette.sh"

# iTerm2 tab helpers (requires scripts/iterm2/iterm-tab).
#
# - `prefix + t`: open new iTerm2 tab in the current pane's directory (and create a tmux window).
# - `prefix + T`: open the preset chooser modal.
bind-key t run-shell -b "$HOME/dotfiles/scripts/iterm2/iterm-tab --dir '#{pane_current_path}'"
bind-key T run-shell -b "$HOME/dotfiles/scripts/iterm2/iterm-tab --choose"
